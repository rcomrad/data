import{b as M,v as J,a as g}from"./runtime-dom.esm-bundler-6f3b7d2d.js";import{a as y,U as $}from"./axios-2f89820f.js";import{u as B}from"./vuex.esm-bundler-a5fb55b5.js";import{D as F}from"./utils-f0c35e88.js";import{G as _,z as x,H as N,o as n,c as u,a as e,y as S,K as k,L as C,M as b,J as d,N as L,b as w}from"./runtime-core.esm-bundler-c941a8b7.js";import{M as O}from"./bootstrap.esm-9a522539.js";const D={class:"table table-striped text-center"},I=e("th",null,"Учебный план",-1),R=e("th",null,"Группа/Класс",-1),E=e("th",null,"Учитель",-1),G=e("th",{style:{width:"10%"}},"Изменить",-1),T={style:{width:"10%"}},z=["onClick"],H=e("i",{class:"bi bi-pencil-fill"},null,-1),K=[H],P=["onUpdate:modelValue"],q={__name:"JournalList",props:["filter_by"],emits:["openModal"],setup(V,{emit:f}){const i=V,r=_([]);_([]);const m=B(),c=()=>{y.get($+"/get/if/journal_table[*;teacher_id[*];plan_id[*];group_id[*]]/methodist_id="+JSON.parse(localStorage.getItem("user")).id).then(s=>{r.value=s.data.journal_tables,r.value.forEach(o=>{o.to_delete=!1})})};let h=x(()=>m.state.needReload);c(),N(h,()=>{console.log("reload is"),c()});const U=x(()=>r.value.filter(s=>s.plan.name.toLowerCase().includes(i.filter_by.toLowerCase())||s.group.name.toLowerCase().includes(i.filter_by.toLowerCase())||s.teacher.name.toLowerCase().includes(i.filter_by.toLowerCase())));return(s,o)=>(n(),u("table",D,[e("thead",null,[e("tr",null,[I,R,E,G,e("th",T,[e("button",{class:"btn btn-danger btn-sm",onClick:o[0]||(o[0]=p=>S(F)(r.value,"/drop/journal_table",S(m)))},"Удалить")])])]),e("tbody",null,[(n(!0),u(k,null,C(S(U),p=>(n(),u("tr",null,[e("td",null,b(p.plan.name),1),e("td",null,b(p.group.name),1),e("td",null,b(p.teacher.name)+" "+b(p.teacher.surname),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:a=>s.$emit("openModal",p)},K,8,z)]),e("td",null,[d(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":a=>p.to_delete=a},null,8,P),[[M,p.to_delete]])])]))),256))])]))}},A={class:"row my-3"},Q={class:"col-2"},W={class:"col-2 ms-auto"},X={name:"ButtonBlock"},Y=Object.assign(X,{emits:["setJournal","setFilter"],setup(V,{emit:f}){return(i,r)=>(n(),u("div",A,[e("div",Q,[e("button",{type:"button",class:"btn btn-primary",onClick:r[0]||(r[0]=m=>i.$emit("setJournal",{})),"data-bs-toggle":"modal","data-bs-target":"#journal"}," Создать новый журнал ")]),e("div",W,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:r[1]||(r[1]=m=>i.$emit("setFilter",m.target.value))},null,32)])]))}}),Z={class:"modal fade",id:"journal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"},ee={class:"modal-dialog"},te={class:"modal-content"},le=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с журналами"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),oe={class:"modal-body"},se={class:"mb-3"},ae=e("label",{class:"form-label"},"Учитель",-1),ne=["value"],ue=e("div",{class:"form-text"},"Роль учителя автоматически вытавится после сохранения",-1),re={class:"mb-3"},de=e("label",{class:"form-label"},"Учебный план",-1),ie=["value"],ce={class:"form-check mb-3"},me=e("label",{class:"form-check-label"},"Прикрепить к группе",-1),_e={key:0,class:"mb-3"},pe=e("label",{class:"form-label"},"Выбрать группу",-1),be=["value"],ve={key:1,class:"mb-3"},fe=e("label",{class:"form-label"},"Выбрать класс ",-1),he=["value"],ge={class:"mb-3"},ye=e("label",{class:"form-label"},"Рассписание",-1),$e={class:"table"},ke=e("td",null,"Понедельник",-1),Ve=e("td",null,"Вторник",-1),Ue=e("td",null,"Среда",-1),Ce=e("td",null,"Четверг",-1),Je=e("td",null,"Пятница",-1),Se=e("td",null,"Суббота",-1),we=e("td",null,"Воскресенье",-1),je=e("div",{class:"form-text"},"Выберите количество уроков на каждый день недели",-1),xe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),Le={__name:"JournalModal",props:["currentJournal"],setup(V){const f=V,i=_([]),r=_([]),m=_([]),c=_([]),h=_([]),U=B();y.get($+"/get/all/grade[*]").then(a=>{r.value=a.data.grades}),y.get($+"/get/all/subject[*]").then(a=>{h.value=a.data.subjects}),y.get($+"/get/all/user[*]").then(a=>{m.value=a.data.users.filter(l=>!l.role.includes("student"))}),y.get($+"/get/all/group[*]").then(a=>{i.value=a.data.groups}),y.get($+"/get/all/plan[*]").then(a=>{c.value=a.data.plans});const s=_([0,0,0,0,0,0,0]),o=_({});N(f,()=>{if(o.value=f.currentJournal,o.value.id===void 0&&(o.value.id=0),o.value.is_group===void 0&&(o.value.is_group=!1),o.value.schedule!==void 0)for(let a of o.value.schedule)s.value[a-1]+=1});const p=()=>{let a=JSON.parse(localStorage.getItem("user")),l="";for(let v=1;v<7;v++)for(let j=0;j<s.value[v-1];j++)l+=v+" ";l=l.slice(0,-1);let t={id:o.value.id,teacher_id:o.value.teacher.id,methodist_id:a.id,is_group:o.value.is_group,group_id:o.value.group.id,subject_id:c.value.filter(v=>v.name===o.value.plan.name)[0].subject_id,plan_id:c.value.filter(v=>v.name===o.value.plan.name)[0].id,schedule:l};console.log(t),y({method:"POST",url:$+"/post/journal_table",data:t}).then(()=>{U.commit("changeReload")})};return(a,l)=>(n(),u("div",Z,[e("div",ee,[e("div",te,[le,e("div",oe,[e("div",se,[ae,d(e("select",{class:"form-select","onUpdate:modelValue":l[0]||(l[0]=t=>o.value.teacher=t)},[(n(!0),u(k,null,C(m.value,t=>(n(),u("option",{value:t},b(t.name)+" "+b(t.surname),9,ne))),256))],512),[[J,o.value.teacher]]),ue]),e("div",re,[de,d(e("select",{class:"form-select","onUpdate:modelValue":l[1]||(l[1]=t=>o.value.plan=t)},[(n(!0),u(k,null,C(c.value,t=>(n(),u("option",{value:t},b(t.name),9,ie))),256))],512),[[J,o.value.plan]])]),e("div",ce,[d(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=t=>o.value.is_group=t)},null,512),[[M,o.value.is_group]]),me]),o.value.is_group?(n(),u("div",_e,[pe,d(e("select",{class:"form-select","onUpdate:modelValue":l[3]||(l[3]=t=>o.value.group=t)},[(n(!0),u(k,null,C(i.value,t=>(n(),u("option",{value:t},b(t.name),9,be))),256))],512),[[J,o.value.group]])])):L("",!0),o.value.is_group?L("",!0):(n(),u("div",ve,[fe,d(e("select",{class:"form-select","onUpdate:modelValue":l[4]||(l[4]=t=>o.value.group=t)},[(n(!0),u(k,null,C(r.value,t=>(n(),u("option",{value:t},b(t.name),9,he))),256))],512),[[J,o.value.group]])])),e("div",ge,[ye,e("table",$e,[e("tr",null,[ke,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[5]||(l[5]=t=>s.value[0]=t)},null,512),[[g,s.value[0]]])])]),e("tr",null,[Ve,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[6]||(l[6]=t=>s.value[1]=t)},null,512),[[g,s.value[1]]])])]),e("tr",null,[Ue,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[7]||(l[7]=t=>s.value[2]=t)},null,512),[[g,s.value[2]]])])]),e("tr",null,[Ce,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[8]||(l[8]=t=>s.value[3]=t)},null,512),[[g,s.value[3]]])])]),e("tr",null,[Je,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[9]||(l[9]=t=>s.value[4]=t)},null,512),[[g,s.value[4]]])])]),e("tr",null,[Se,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[10]||(l[10]=t=>s.value[5]=t)},null,512),[[g,s.value[5]]])])]),e("tr",null,[we,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":l[11]||(l[11]=t=>s.value[6]=t)},null,512),[[g,s.value[6]]])])])]),je])]),e("div",{class:"modal-footer"},[xe,e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:p},"Сохранить")])])])]))}},Ie={__name:"MakeJournal",setup(V){const f=_(""),i=c=>{f.value=c},r=c=>{i(c),new O("#journal").toggle()},m=_("");return(c,h)=>(n(),u(k,null,[w(Y,{onSetJournal:i,onSetFilter:h[0]||(h[0]=U=>{m.value=U})}),w(Le,{"current-journal":f.value},null,8,["current-journal"]),w(q,{filter_by:m.value,onOpenModal:r},null,8,["filter_by"])],64))}};export{Ie as default};
