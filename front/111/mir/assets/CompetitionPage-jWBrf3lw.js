var b=Object.defineProperty;var g=(t,e,a)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var v=(t,e,a)=>(g(t,typeof e!="symbol"?e+"":e,a),a);import{j as s,R as h,r as f,b as p}from"./index-bX3MG7j1.js";import{A as j}from"./config-0xx7l4yL.js";import{G as N}from"./competition-gMFPniL6.js";import{G as k}from"./users-My4gugrs.js";async function T(t){return(await(await fetch(`${j}/get/if/competition_question/competition_id=${t}`)).json()).competition_questions}async function V(t,e){const n=await(await fetch(`${j}/get_question/${e}/${t}`)).json();return console.log(n),n.question}async function q(t,e,a){console.log(t,e,a);const n=await fetch(`${j}/post/answer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t,question_id:e,value:a})});console.log(await n.json())}function w(t){return s.jsx("div",{className:"mt-4",style:{maxHeight:"50vh",overflowY:"scroll"},children:s.jsx("ul",{className:"list-group",children:t.shortQuestions.map(e=>s.jsx("a",{className:`list-group-item list-group-item-action ${e.question_id==t.activeQuestionId?"active":""}`,role:"button",onClick:()=>{var a;return(a=t.onQuestionClick)==null?void 0:a.call(t,e.question_id)},children:e.name},e.question_id))})})}function y({onChange:t,defaultValue:e,required:a}){const[n,r]=h.useState(e??"");return s.jsx("input",{className:"form-check-input",type:"checkbox",required:a,checked:n==="true",onChange:c=>{t(c.currentTarget.checked?"true":"false"),r(c.currentTarget.checked?"true":"false")}})}class C{createElement(e,a,n){return s.jsxs("div",{className:"mb-3 form-check",children:[s.jsx(y,{required:e.required,onChange:a,defaultValue:e.defaultValue,...e.properties}),s.jsx("label",{className:"form-check-label",children:e.label}),s.jsx("div",{className:"invalid-feedback",children:e.invalidText??n??"This field is required"})]})}getDefaultValue(e){return e.defaultValue??"false"}}function S({onChange:t,type:e,defaultValue:a,required:n,min:r,max:c,step:u}){const[i,l]=h.useState(a??"");return f.useEffect(()=>{l(a??"")},[a]),s.jsx("input",{type:e,required:n,className:"form-control",min:r,max:c,step:u,value:i,onChange:o=>{t(o.currentTarget.value),l(o.currentTarget.value)}})}class E{createElement(e,a,n){return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:e.label}),s.jsx(S,{onChange:a,required:e.required,defaultValue:e.defaultValue,...e.properties}),s.jsx("div",{className:"invalid-feedback",children:e.invalidText??n??"This field is required"})]})})}getDefaultValue(e){return e.defaultValue}}function _({onChange:t,defaultValue:e,options:a,name:n,required:r,invalidText:c}){const[u,i]=f.useState(e);return s.jsx(s.Fragment,{children:a.map((l,o)=>s.jsxs("div",{className:"mb-3 form-check",children:[s.jsx("input",{className:"form-check-input",type:"radio",name:n,required:r,checked:u===l,"aria-labelledby":"id_"+l,onChange:()=>{i(l),t(l)}}),s.jsx("label",{className:"form-check-label",id:"id_"+l,children:l}),o===a.length-1&&r?s.jsx("div",{className:"invalid-feedback",children:c}):null]},l))})}class I{createElement(e,a,n){return s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:e.label}),s.jsx(_,{onChange:a,required:e.required,invalidText:e.invalidText??n??"This field is required",defaultValue:e.defaultValue,name:e.name,...e.properties})]})}getDefaultValue(e){return e.defaultValue}}function Q(t,e,a){return a||(e?[]:t[0].value)}function A({onChange:t,options:e,multiple:a,defaultValue:n,required:r}){const[c,u]=h.useState(Q(e,a,n));return s.jsx("select",{className:"form-select",value:c,required:r,multiple:a,onChange:i=>{a?(u([...i.currentTarget.selectedOptions].map(l=>l.value)),t([...i.currentTarget.selectedOptions].map(l=>l.value))):(u(i.currentTarget.value),t(i.currentTarget.value))},children:e.map(i=>s.jsx("option",{value:i.value,children:i.label},i.value))})}class D{createElement(e,a,n){return s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:e.label}),s.jsx(A,{onChange:a,required:e.required,defaultValue:e.defaultValue,...e.properties}),s.jsx("div",{className:"invalid-feedback",children:e.invalidText??n??"Please fill this field"})]})}getDefaultValue(e){return e.defaultValue?e.defaultValue:e.properties.multiple?[]:e.properties.options[0].value}}function B({onChange:t,defaultValue:e,rows:a,cols:n,required:r}){const[c,u]=f.useState(e);return s.jsx("textarea",{className:"form-control",rows:a,cols:n,required:r,onChange:i=>{t(i.target.value),u(i.target.value)},value:c})}class ${createElement(e,a,n){return s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:e.label}),s.jsx(B,{required:e.required,defaultValue:e.defaultValue,onChange:a,...e.properties}),s.jsx("div",{className:"invalid-feedback",children:e.invalidText??n??"This field is required"})]})}getDefaultValue(e){return e.defaultValue}}const m=class m{constructor(){v(this,"_elements",new Map([["input",new E],["checkbox",new C],["radio",new I],["select",new D],["textarea",new $]]))}static getInstance(){return m._instance||(m._instance=new m),m._instance}addElement(e,a){this._elements.set(e,a)}getElementByName(e){return this._elements.get(e)}};v(m,"_instance");let x=m;function G(t,e,a,n){var r;return(r=x.getInstance().getElementByName(t.type))==null?void 0:r.createElement(t,c=>{a({...e,[t.name]:c})},n)}function P(t){let e={};return t.forEach(a=>{var r;let n=(r=x.getInstance().getElementByName(a.type))==null?void 0:r.getDefaultValue(a);n!==void 0&&(e[a.name]=n)}),e}function R({title:t,elements:e,onButtonClick:a,buttonText:n,defaultInvalidText:r}){const[c,u]=h.useState({}),[i,l]=h.useState("");return f.useEffect(()=>{u(P(e))},[e]),s.jsxs(s.Fragment,{children:[s.jsx("h1",{children:t}),s.jsxs("form",{noValidate:!0,className:i,onSubmit:o=>{o.preventDefault(),o.stopPropagation(),o.currentTarget.checkValidity()?a(c):l("was-validated")},children:[e.map(o=>s.jsx("div",{children:G(o,c,u,r)},o.label)),s.jsx("button",{type:"submit",className:"btn btn-primary",children:n??"Submit"})]})]})}function M(t){return s.jsxs("div",{className:"d-flex flex-column h-100 justify-content-between",children:[s.jsx("div",{className:"fs-3 pb-4 border-bottom ",children:t.question.name}),s.jsx("div",{style:{maxHeight:"50vh",overflowY:"scroll"},children:s.jsx("div",{className:"fs-5",dangerouslySetInnerHTML:{__html:t.question.legend}})}),s.jsxs("div",{className:"fs-5 pt-1 border-top",children:[t.question.answer?s.jsxs("div",{className:"text-secondary fs-6",children:['Ответ "',t.question.answer,'" сохранен']}):null,s.jsx(R,{elements:[{type:"input",name:"answer",label:"",required:!0,defaultValue:t.question.answer??"",properties:{}}],buttonText:"Отправить",defaultInvalidText:"Поле обязательно для заполнения",onButtonClick:e=>{var a;(a=t.onAnswer)==null||a.call(t,e.answer)}})]})]})}function Y(){const t=p(),e=k()??{},[a,n]=f.useState([]),[r,c]=f.useState({}),[u,i]=f.useState(-1),[l,o]=f.useState({});return f.useEffect(()=>{T(parseInt(t.id??"-1")).then(d=>{n(d),d.length>0&&i(1)}),N(parseInt(t.id??"-1")).then(d=>{c(d??{})})},[]),f.useEffect(()=>{u!=-1&&V(e.id,u).then(d=>{o(d)})},[u]),s.jsx("div",{className:"container-fluid",children:s.jsxs("div",{className:"row p-4 full-height",children:[s.jsxs("div",{className:"col-2 pe-4 border-end",children:[s.jsx("div",{className:"fs-3 pb-4 border-bottom ",children:r.name}),s.jsx(w,{shortQuestions:a,activeQuestionId:u,onQuestionClick:d=>i(d)})]}),s.jsx("div",{className:"col-10",children:s.jsx(M,{question:l,onAnswer:d=>{o({...l,answer:"..."}),q(e.id,u,d).then(()=>{o({...l,answer:d})})}})})]})})}export{Y as default};
