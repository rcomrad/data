import{a as y,U as w}from"./axios-940a6ca7.js";import{v as J,a as V}from"./runtime-dom.esm-bundler-b9ecab8c.js";import{z as $,G as f,H as D,o as u,c as d,a as t,J as j,K as b,L as g,y as S,M as h,N as C,A as N,b as k,O as U}from"./runtime-core.esm-bundler-292d2fca.js";import{M as B}from"./bootstrap.esm-9a522539.js";const I={class:"row my-3"},O={class:"col-2"},T=["value"],A={class:"col-2"},q=["disabled"],F=["value"],z={class:"col-2 ms-auto"},H={__name:"SelectionBlock",props:["journals","grades","groups","show_themes"],emits:["setJournal","setShow"],setup(_,{emit:i}){const l=_,r=$(()=>{let o=[];for(let e of l.journals)o.includes(e.subject)||o.push(e.subject);return o}),n=f(""),c=$(()=>{let o=[];for(let e of l.journals)!o.includes(e.group_id)&&e.subject===n.value&&(e.is_group?o.push(l.groups.filter(s=>s.id===e.group_id)[0]):o.push(l.grades.filter(s=>s.id===e.group_id)[0]));return o}),a=f("");return D(a,o=>{const e=l.journals.filter(s=>s.group_id===a.value&&s.subject===n.value)[0];e&&i("setJournal",e)}),(o,e)=>(u(),d("div",I,[t("div",O,[j(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s)},[(u(!0),d(b,null,g(S(r),s=>(u(),d("option",{value:s},h(s),9,T))),256))],512),[[J,n.value]])]),t("div",A,[j(t("select",{class:"form-select","aria-label":"Default select example",disabled:n.value==="","onUpdate:modelValue":e[1]||(e[1]=s=>a.value=s)},[(u(!0),d(b,null,g(S(c),s=>(u(),d("option",{value:s.id},h(s.name),9,F))),256))],8,q),[[J,a.value]])]),t("div",z,[a.value!==""?(u(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=s=>o.$emit("setShow",!_.show_themes))},h(_.show_themes?"Убрать темы":"Показать темы"),1)):C("",!0)])]))}},P=t("th",{style:{"min-width":"10vw"}},"Имя",-1),E=t("th",null,"Сред.",-1),G=["onClick"],K={__name:"TableHeader",props:{lessons:{type:Array,required:!0}},emits:["setModalLesson"],setup(_,{emit:i}){const l=n=>{let c=new Date(n);return`${String(c.getDate()).padStart(2,"0")}.${String(c.getMonth()+1).padStart(2,"0")}`},r=n=>{i("setModalLesson",n),new B("#lesson").toggle()};return(n,c)=>(u(),d("thead",null,[t("tr",null,[P,E,(u(!0),d(b,null,g(_.lessons,a=>(u(),d("th",{scope:"col",style:{},onClick:o=>r(a)},h(l(a.date)),9,G))),256))])]))}},R={scope:"row",style:{}},Q={style:{}},W=["value","onInput"],X={__name:"TableBody",props:{lessons:{type:Array,required:!0},marks:{type:Array,required:!0},students:{type:Array,required:!0}},setup(_){const i=_;function l(a,o){for(const e of i.marks)if(e.student===a&&e.lesson===o)return e;i.marks.push({value:"",id:-1,student:a,lesson:o});for(const e of i.marks)if(e.student===a&&e.lesson===o)return e}const r=N({});function n(a){let o=0,e=0;for(const s of i.marks)s.student===a&&["1","2","3","4","5"].includes(s.value)&&(o+=parseInt(s.value),e+=1);e===0?r[a]="":r[a]=parseFloat((o/e).toFixed(3))}D(i,()=>{for(let a of i.students)n(a.id)});function c(a,o,e,s){s.value=a.target.value,n(o.id),y({url:w+"/mark",method:"POST",data:{student:o.id,lesson:e.id,id:s.id,value:a.target.value},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(M=>{})}return(a,o)=>(u(),d("tbody",null,[(u(!0),d(b,null,g(_.students,e=>(u(),d("tr",null,[t("th",R,h(e.surname)+" "+h(e.name[0])+".",1),t("td",null,h(r[e.id]),1),(u(!0),d(b,null,g(_.lessons,s=>(u(),d("td",Q,[t("input",{type:"text",class:"form-control border-0 bg-transparent text-center",value:l(e.id,s.id).value,onInput:M=>c(M,e,s,l(e.id,s.id)),style:{padding:"0"}},null,40,W)]))),256))]))),256))]))}},Y={class:"table table-striped table-bordered"},Z=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Тема"),t("th",{style:{width:"15%"}},"Дата")])],-1),ee=["onClick"],te={__name:"ThemeBlock",props:["lessons"],emits:["setModalLesson"],setup(_,{emit:i}){const l=n=>{let c=new Date(n);return`${String(c.getDate()).padStart(2,"0")}.${String(c.getMonth()+1).padStart(2,"0")}`},r=n=>{i("setModalLesson",n),new B("#lesson").toggle()};return(n,c)=>(u(),d("table",Y,[Z,t("tbody",null,[(u(!0),d(b,null,g(_.lessons,a=>(u(),d("tr",null,[t("th",{scope:"col",onClick:o=>r(a)},h(a.theme),9,ee),t("td",null,h(l(a.date)),1)]))),256))])]))}},se={class:"modal fade",id:"lesson","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"lesson","aria-hidden":"true"},oe={class:"modal-dialog"},le={class:"modal-content"},ae={class:"modal-header"},ne={class:"modal-title fs-5",id:"staticBackdropLabel"},re=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ue={class:"modal-body"},de={class:"mb-3"},ie=t("label",{class:"form-label"},"Дата",-1),ce={class:"mb-3"},me=t("label",{class:"form-label"},"Тип контроля занятия",-1),_e={class:"mb-3"},pe=t("label",{class:"form-label"},"Домашняя работа",-1),ve=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),he={__name:"LessonModal",props:["lesson"],emits:["updateLesson"],setup(_,{emit:i}){const l=_,r=f(""),n=f("");D(l,()=>{r.value=l.lesson.control,n.value=l.lesson.homework});const c=()=>{console.log({id:l.lesson.id,homework:n.value,control:r.value}),y({url:w+"/lesson",method:"POST",data:{id:l.lesson.id,homework:n.value,control:r.value},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(()=>{i("updateLesson",{id:l.lesson.id,homework:n.value,control:r.value})})};return(a,o)=>(u(),d("div",se,[t("div",oe,[t("div",le,[t("div",ae,[t("h1",ne,h(_.lesson.theme),1),re]),t("div",ue,[t("div",de,[ie,t("p",null,h(_.lesson.date),1)]),t("div",ce,[me,j(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=e=>r.value=e)},null,512),[[V,r.value]])]),t("div",_e,[pe,j(t("textarea",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=e=>n.value=e)},null,512),[[V,n.value]])])]),t("div",{class:"modal-footer"},[ve,t("button",{type:"button",class:"btn btn-primary",onClick:c,"data-bs-dismiss":"modal"},"Сохранить")])])])]))}},fe={class:"row"},be={key:0,class:"table table-striped table-bordered",style:{overflow:"auto"}},ge={key:0,class:"col-3",style:{overflow:"auto","max-height":"80vh"}},Se={__name:"JournalView",setup(_){const i=f([]),l=f("");let r=JSON.parse(localStorage.getItem("user"));y.get(w+"/journal/"+r.id,{headers:{token:r.token}}).then(m=>{i.value=m.data.journals});const n=$(()=>{let m=[];for(let p of i.value)p.is_group||y.get(w+"/grade/"+p.group_id,{headers:{token:r.token}}).then(v=>{m.push(v.data)});return m}),c=$(()=>{let m=[];for(let p of i.value)p.is_group&&y.get(w+"/group/"+p.group_id,{headers:{token:r.token}}).then(v=>{m.push(v.data)});return m}),a=$(()=>l.value.is_group?c.value.filter(m=>m.id===l.value.group_id)[0].students:n.value.filter(m=>m.id===l.value.group_id)[0].students),o=m=>{m.lessons.sort((p,v)=>{let x=new Date(p.date),L=new Date(v.date);if(x<L)return-1;if(x===L)return 0;if(x>L)return 1}),l.value=m},e=f(!1),s=f(""),M=m=>{s.value.homework=m.homework,s.value.control=m.control};return(m,p)=>(u(),d(b,null,[k(H,{journals:i.value,grades:S(n),groups:S(c),show_themes:e.value,onSetJournal:o,onSetShow:p[0]||(p[0]=v=>{e.value=v})},null,8,["journals","grades","groups","show_themes"]),k(he,{lesson:s.value,onUpdateLesson:M},null,8,["lesson"]),t("div",fe,[t("div",{class:U(e.value?"col-9":"col-12"),style:{overflow:"auto"}},[l.value?(u(),d("table",be,[k(K,{lessons:l.value.lessons,onSetModalLesson:p[1]||(p[1]=v=>{s.value=v})},null,8,["lessons"]),k(X,{students:S(a),marks:l.value.marks,lessons:l.value.lessons},null,8,["students","marks","lessons"])])):C("",!0)],2),e.value?(u(),d("div",ge,[k(te,{lessons:l.value.lessons,onSetModalLesson:p[2]||(p[2]=v=>{s.value=v})},null,8,["lessons"])])):C("",!0)])],64))}};export{Se as default};
