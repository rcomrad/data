import{a as v,v as M,d as V}from"./runtime-dom.esm-bundler-b9ecab8c.js";import{a as k,U as S}from"./axios-940a6ca7.js";import{u as C}from"./vuex.esm-bundler-af09927f.js";import{A as B,H as x,o as m,c as _,a as e,J as c,S as N,G as w,z as U,y,K as L,L as F,M as g,b as $}from"./runtime-core.esm-bundler-292d2fca.js";import{D as O}from"./utils-60e751a2.js";import{M as D}from"./bootstrap.esm-9a522539.js";const G={class:"modal fade",id:"user","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"user","aria-hidden":"true"},I={class:"modal-dialog"},J={class:"modal-content"},R=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с юзером"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},E={class:"mb-3"},P=e("label",{class:"form-label"},"Имя",-1),T={class:"mb-3"},z=e("label",{class:"form-label"},"Фамилия",-1),A={class:"mb-3"},H=e("label",{class:"form-label"},"Логин",-1),K=e("div",{class:"form-text"},"По этому логину будет осуществляться вход",-1),q={class:"mb-3"},Q=e("label",{class:"form-label"},"Пароль",-1),W={class:"mb-3"},X=e("label",{class:"form-label"},"Выбрать роль",-1),Y=N('<option value="student">Обучающийся</option><option value="teacher">Педагог</option><option value="grade_head">Классный руководитель</option><option value="add_user">Разрешено управление юзерами</option><option value="add_journal">Разрешено управление журналами</option><option value="add_plan">Разрешено управление учебными планами</option><option value="add_grade">Разрешено управление классами</option>',7),Z=[Y],ee=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),te={__name:"UserModal",props:["user"],emits:["reGet"],setup(p,{emit:b}){const s=p,r=C(),t=B({id:"",name:"",surname:"",login:"",password:"",roles:[""]});x(s,()=>{t.id=s.user.id,t.name=s.user.name,t.surname=s.user.surname,t.login=s.user.login,t.password=s.user.password,t.role=s.user.role});const i=()=>{let u=[];for(let o of t.role)u.push(o);k({method:"POST",url:S+"/post/user",data:{id:t.id===void 0?0:t.id,name:t.name,surname:t.surname,login:t.login,password:t.password,role:u,school_id:JSON.parse(localStorage.getItem("user")).school_id},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(()=>{r.commit("changeReload")})};return(u,o)=>(m(),_("div",G,[e("div",I,[e("div",J,[R,e("div",j,[e("div",E,[P,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=d=>t.name=d)},null,512),[[v,t.name]])]),e("div",T,[z,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=d=>t.surname=d)},null,512),[[v,t.surname]])]),e("div",A,[H,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=d=>t.login=d)},null,512),[[v,t.login]]),K]),e("div",q,[Q,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=d=>t.password=d)},null,512),[[v,t.password]])]),e("div",W,[X,c(e("select",{class:"form-control","onUpdate:modelValue":o[4]||(o[4]=d=>t.role=d),multiple:""},Z,512),[[M,t.role]])])]),e("div",{class:"modal-footer"},[ee,e("button",{type:"button",class:"btn btn-primary",onClick:i,"data-bs-dismiss":"modal"},"Сохранить")])])])]))}},se={class:"row my-3"},oe={class:"col-2"},le=e("div",{class:"col-2"},[e("button",{type:"button",class:"btn btn-primary",disabled:""}," Загрузить через файл ")],-1),ae={class:"col-2 ms-auto"},ne={__name:"ButtonBlock",emits:["setUser","setFilter"],setup(p,{emit:b}){return(s,r)=>(m(),_("div",se,[e("div",oe,[e("button",{type:"button",class:"btn btn-primary",onClick:r[0]||(r[0]=t=>s.$emit("setUser",{})),"data-bs-toggle":"modal","data-bs-target":"#user"}," Создать новых юзеров ")]),le,e("div",ae,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:r[1]||(r[1]=t=>s.$emit("setFilter",t.target.value))},null,32)])]))}},re={class:"table table-striped text-center"},de=e("th",null,"Имя",-1),ie=e("th",null,"Роль",-1),ue=e("th",null,"Логин",-1),ce=e("th",{style:{width:"10%"}},"Изменить",-1),me={style:{width:"10%"}},_e=["onClick"],pe=e("i",{class:"bi bi-pencil-fill"},null,-1),be=[pe],he=["onUpdate:modelValue"],fe={__name:"UserList",props:["filter_by"],emits:["openModal"],setup(p,{emit:b}){const s=p,r=C(),t=w([]),i=()=>{k.get(S+"/get/all/user").then(a=>{t.value=a.data.users.filter(n=>!n.role.includes("admin")&&!n.role.includes("director")||JSON.parse(localStorage.getItem("user")).role.includes("admin")),t.value.sort((n,l)=>h(n.role)>h(l.role)?1:h(n.role)<h(l.role)?-1:n.surname+n.name>l.surname+l.name?1:-1),t.value.forEach(n=>{n.to_delete=!1})})};i();let u=U(()=>r.state.needReload);x(u,()=>{i()});const o=a=>{const n={student:"Обучающийся",teacher:"Педагог",grade_head:"Кл. руководитель",add_user:"Упр. юзерами",add_journal:"Упр. журналом",add_plan:"Упр. планами",add_grade:"Упр. классами",submitor:"Участник соревнований"};let l="";for(let f of a)l+=n[f]+" ";return l},d=U(()=>t.value.filter(a=>a.name.toLowerCase().includes(s.filter_by.toLowerCase())||a.surname.toLowerCase().includes(s.filter_by.toLowerCase())||a.login.toLowerCase().includes(s.filter_by.toLowerCase())||o(a.role).toLowerCase().includes(s.filter_by.toLowerCase()))),h=a=>a.includes("student")?1:a.includes("teacher")||a.includes("grade_head")?2:3;return(a,n)=>(m(),_("table",re,[e("thead",null,[e("tr",null,[de,ie,ue,ce,e("th",me,[e("button",{class:"btn btn-danger btn-sm",onClick:n[0]||(n[0]=l=>y(O)(t.value,"/drop/user",y(r)))},"Удалить")])])]),e("tbody",null,[(m(!0),_(L,null,F(y(d),l=>(m(),_("tr",null,[e("td",null,g(l.surname)+" "+g(l.name),1),e("td",null,g(o(l.role)),1),e("td",null,g(l.login),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:f=>a.$emit("openModal",l)},be,8,_e)]),e("td",null,[c(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":f=>l.to_delete=f},null,8,he),[[V,l.to_delete]])])]))),256))])]))}},ke={__name:"MakeUser",setup(p){const b=w({}),s=i=>{b.value=i},r=i=>{s(i),new D("#user").toggle()},t=w("");return(i,u)=>(m(),_(L,null,[$(ne,{onSetUser:s,onSetFilter:u[0]||(u[0]=o=>{t.value=o})}),$(te,{user:b.value},null,8,["user"]),$(fe,{onOpenModal:r,filter_by:t.value},null,8,["filter_by"])],64))}};export{ke as default};
